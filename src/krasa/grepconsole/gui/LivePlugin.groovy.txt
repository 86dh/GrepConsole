import com.intellij.ide.plugins.PluginManager
import com.intellij.openapi.extensions.PluginId
import java.util.function.Function
import static liveplugin.PluginUtil.*

try {
    com.intellij.ide.plugins.IdeaPluginDescriptorImpl descriptor = PluginManager.getPlugin(PluginId.getId("GrepConsole"))
    def clazz = descriptor
            .getPluginClassLoader()
            .loadClass("krasa.grepconsole.plugin.ExtensionManager");

//    clazz.getMethod("unregisterFunction", String.class)
//            .invoke(null, "name")

    clazz.getMethod("registerFunction", String.class, Function.class)
            .invoke(null, "name",
            new Function<String, String>() {
                @Override
                String apply(String s) {
                    return s.toUpperCase()
                }
            });

    show("Done")
} catch (Exception e) {
    throw new RuntimeException(e);
}
